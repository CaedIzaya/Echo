# 数据恢复指南 - 用户版

## 😱 遇到了什么问题？

如果您发现：
- ✅ 之前有的等级和经验值消失了
- ✅ 解锁的成就不见了
- ✅ 系统把您当成新用户
- ✅ 触发了"首次"成就（但您明明不是第一次）

**不要担心！您的数据仍然安全地保存在云端服务器中。**

## 🤔 为什么会发生这种情况？

最常见的原因是 **浏览器缓存被清除**：

1. **手动清除浏览器缓存**
   - 清理了浏览器数据
   - 使用了"清除历史记录"功能

2. **使用无痕/隐私模式**
   - 无痕模式不保存数据
   - 关闭窗口后数据消失

3. **更换设备或浏览器**
   - 本地数据不会自动迁移
   - 需要从云端恢复

4. **浏览器设置**
   - 浏览器设置为"退出时清除数据"
   - 安全软件自动清理

## ✅ 解决方案（三种方法）

### 方法一：等待自动恢复（推荐）

系统会在您登录时自动检测数据异常并恢复：

1. **保持登录状态**
   - 不要刷新页面
   - 等待 5-10 秒

2. **查看浏览器控制台**
   - 按 F12 打开开发者工具
   - 查看 Console 标签
   - 寻找 `[DataIntegrity] ✅ 数据已自动恢复` 的消息

3. **刷新页面**
   - 如果看到恢复成功的消息
   - 刷新页面 (F5 或 Ctrl+R)
   - 您的数据应该恢复了

### 方法二：使用恢复按钮

如果系统检测到数据异常，会显示一个弹窗：

1. **看到"检测到数据异常"弹窗**
   - ⚠️ 图标和黄色背景
   - 说明可能的原因

2. **点击"恢复数据"按钮**
   - 等待数据从云端恢复
   - 通常只需要几秒钟

3. **页面自动刷新**
   - 恢复完成后自动刷新
   - 检查数据是否恢复

### 方法三：手动触发恢复

如果前两种方法都不行，可以手动触发恢复：

1. **打开浏览器控制台**
   - Windows/Linux: `F12` 或 `Ctrl+Shift+I`
   - Mac: `Cmd+Option+I`

2. **切换到 Console 标签**

3. **输入以下代码并回车**
```javascript
// 导入恢复函数并执行
(async () => {
  const { recoverDataFromDatabase } = await import('./src/lib/DataIntegritySystem');
  const success = await recoverDataFromDatabase();
  if (success) {
    console.log('✅ 数据恢复成功！正在刷新页面...');
    setTimeout(() => location.reload(), 2000);
  } else {
    console.error('❌ 数据恢复失败，请联系客服');
  }
})();
```

4. **等待恢复完成**
   - 看到成功消息后页面会自动刷新

## 🔍 检查数据是否恢复成功

恢复后，检查以下内容：

- ✅ **用户等级**：应该恢复到之前的等级
- ✅ **经验值**：应该显示正确的数值
- ✅ **成就**：已解锁的成就应该都在
- ✅ **专注记录**：历史专注时长应该正确

## ❌ 如果恢复失败

### 检查网络连接

1. 确保您的网络连接正常
2. 刷新页面重试
3. 尝试重新登录

### 检查数据库中是否有数据

如果您有技术背景，可以：

1. 运行诊断脚本（需要开发环境）：
```bash
npx tsx scripts/check-data-integrity.ts your-email@example.com
```

2. 查看输出，确认数据库中是否有您的数据

### 联系客服

如果多次尝试都失败，请联系客服并提供以下信息：

- **您的账号邮箱**
- **问题发生的时间**
- **您最后一次看到正确数据的时间**
- **浏览器控制台的错误信息**（如果有）

## 🛡️ 如何防止将来再次发生？

### 1. 不要清除浏览器缓存

如果必须清除：
- **只清除"下载历史"和"浏览历史"**
- **不要清除"Cookie"和"网站数据"**

### 2. 避免使用无痕模式

- 使用无痕模式时数据不会保存
- 建议使用正常模式访问 Echo

### 3. 定期登录

- 至少每周登录一次
- 让系统自动同步数据到云端

### 4. 检查浏览器设置

确保浏览器没有设置为：
- ❌ 退出时清除 Cookie
- ❌ 退出时清除网站数据
- ❌ 始终使用无痕模式

## 🔧 技术细节（开发者）

### 数据保存位置

您的数据保存在两个地方：

1. **localStorage**（本地）
   - 快速访问
   - 立即生效
   - 可能被清除

2. **PostgreSQL 数据库**（云端）
   - 持久化存储
   - 跨设备同步
   - 权威数据源

### 数据同步机制

```
每次数据更新：
1. 立即保存到 localStorage（用户体验）
2. 异步同步到数据库（可靠性）
3. 设置防护标记（防止误判）
```

### 恢复优先级

```
数据冲突时的处理：
1. 数据库数据 > localStorage 数据
2. 如果数据库为空，使用 localStorage
3. 如果都为空，可能是新用户
```

## 📞 获取帮助

### 开发者支持

- **GitHub Issues**: [项目地址]
- **邮件支持**: support@echo-app.com
- **技术文档**: `DATA_PROTECTION_SYSTEM.md`

### 用户社区

- **用户论坛**: [社区地址]
- **常见问题**: [FAQ地址]
- **使用教程**: [文档地址]

## 📝 常见问题

### Q1: 恢复数据会覆盖我现在的数据吗？

**A:** 不会。恢复功能会：
- 保留您现在的数据
- 合并云端的数据
- 使用数据库中的权威数据

### Q2: 我的专注记录会丢失吗？

**A:** 不会。所有专注记录都保存在数据库中，可以完全恢复。

### Q3: 恢复需要多长时间？

**A:** 通常只需要 5-10 秒。如果网络较慢，可能需要更长时间。

### Q4: 可以恢复多久以前的数据？

**A:** 可以恢复您账号创建以来的所有数据。数据库永久保存。

### Q5: 我换了设备，数据怎么办？

**A:** 只需要在新设备上登录，系统会自动从云端恢复所有数据。

---

**希望这个指南对您有帮助！**

如果问题仍未解决，请随时联系我们的支持团队。

🌟 **Echo 团队** | 让专注变得更简单








