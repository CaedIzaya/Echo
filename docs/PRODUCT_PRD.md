## 产品需求文档（PRD）—— Echo Focus / 数字静默

### 一、产品定位
一句话版本：一个把“专注、回顾、成长记录”放在同一处的轻量工具，让用户看见自己的节奏而不是被 KPI 追着跑。

目标用户：
- 20~35 岁，学习或工作压力大、对自己要求高的人
- 用过效率工具但容易疲惫，对“打卡/排名/惩罚”敏感
- 需要一个温和但能持续使用的专注与回顾工具

### 二、核心痛点
1. 专注容易被打断，且只看“时长”无法判断状态质量
2. 长期目标太大，缺少拆解与阶段反馈
3. 回顾断裂，记住失败多过记住成长

### 三、核心功能（5个）
#### 功能 A：专注计时与心流反馈
**背景**：用户需要一个不会被后台切换影响、能真实记录的专注计时，并希望知道“这次有没有进入状态”。

**解决问题**：
- 计时不准、记录丢失
- 只看时长，无法判断质量

**用户是谁**：需要高频专注（学习、写作、编码、备考等）的人

**设计逻辑**：
- 以时间戳计算真实时长，避免后台挂起造成误差
- 3 秒倒计时进入、可暂停/恢复、有完成与中断区分
- 结束后评分 + `flowEngine` 计算心流指标
- 数据写入 `FocusSession`，并同步到 `todayStats / weeklyStats / flowMetrics`

**指标假设（验证逻辑）**：
- 完成率 `completionRate` 上升、中断率 `interruptionRate` 下降
- 平均专注时长、最长时长（`flowMetrics.averageSessionLength / longestSession`）提高
- 心流均值（`flowIndex` 或 `flowMetrics.impressionScore`）稳定提高

---

#### 功能 B：计划与里程碑
**背景**：长期目标太大，用户不知道从哪里开始。

**解决问题**：
- 目标无法拆解
- 进度无反馈

**用户是谁**：有长期目标（论文、项目、技能成长）但执行困难的人

**设计逻辑**：
- 计划（Project）+ 里程碑（Milestone）的结构化拆解
- 每个计划可设置每日目标时长、主计划、是否完成
- 里程碑完成与专注记录挂钩，形成可见的进度感

**指标假设（验证逻辑）**：
- 里程碑完成数（`Milestone.isCompleted`）持续上升
- 主计划达标率：当日专注分钟 ≥ `dailyGoalMinutes`
- 计划完成数与持续天数（`Project.completedMilestones / streakDays`）

---

#### 功能 C：日小结 + 日记星空 + 分享
**背景**：用户做了很多事，但很难在一天结束时看见自己的努力。

**解决问题**：
- 回顾缺失，成长被忽略
- 记录成本高、很难坚持

**用户是谁**：想要回顾但讨厌写长日记的人

**设计逻辑**：
- 日小结限制为 4 行以内，降低写作成本
- `DailySummary` 入库，可生成分享链接（`ShareLink`）
- 日记页面用“星空”展示最近 100 天记录，点击可看当天详情

**指标假设（验证逻辑）**：
- 有专注的天数里，写小结的比例上升（`DailySummary` / 专注日）
- 分享链接生成数（`ShareLink` 数量）
- 日记页面可点击天数增加（由 `hasSummary` 天数衡量）

---

#### 功能 D：心树成长 + 果实商店 + 主题
**背景**：用户需要一个长期的、温和的成长反馈，不想被惩罚机制压着走。

**解决问题**：
- 长期努力缺乏可视化反馈
- 奖励机制过强或带惩罚感

**用户是谁**：需要“慢反馈”而非“强刺激”的持续使用者

**设计逻辑**：
- 心树经验系统：浇水（完成专注）+ 施肥（成就触发）
- 心树等级、经验进度持续累计
- 果实作为轻量兑换单位，商城提供主题/勋章
- 勋章购买触发邮件，增强反馈闭环

**指标假设（验证逻辑）**：
- 心树等级与总经验（`heartTreeLevel / heartTreeTotalExp`）稳定增长
- 果实获得/消耗（`fruits / totalFruitsEarned`）形成闭环
- 商城购买数（`ShopPurchase`）增长

---

#### 功能 E：收件箱 + 周报生成
**背景**：周期性回顾比日常回顾更能看到趋势。

**解决问题**：
- 长期变化不易被感知
- 没有定期的提醒与总结

**用户是谁**：希望每周看一次整体趋势的人

**设计逻辑**：
- `weeklyReport` 周报在后端按注册日锚点生成
- 生成后写入 `Mail`，在收件箱中可见
- 邮件支持已读/未读，作为轻量提醒

**指标假设（验证逻辑）**：
- 周报生成数（`WeeklyReport`）与用户活跃周期一致
- 收件箱已读率（`Mail.isRead`）提升

---

### 四、AI能力应用
> 当前版本**未接入外部模型**，采用规则引擎 + 文案池实现“轻觉察”。此处只描述已实现内容。

**使用场景**：
- Dashboard 小精灵在用户“长时间无动作、频繁点击、深夜在线”等情况下给出觉察文案
- 心树与 Lumi 的情绪文案以规则触发，不打断主流程

**用户是谁**：对强提醒敏感、更需要陪伴式反馈的用户（尤其是长时间无动作或深夜在线的人）

**技术路径**：
- `AwarenessContext` 从用户状态与行为事件构建
- `rules.ts` 规则命中 → `priority-manager` 决定是否抢占文案
- `SpiritDialog` 统一展示（支持 awareness 类型）

**结构设计**：
- 规则引擎：`src/awareness/engine.ts`
- 规则集合：`src/awareness/rules.ts`
- 触发入口：Dashboard 内 `handleAwarenessEvent`
- 文案池：`echoSpiritDialogueV2.ts` + `heartTreeDialogue.ts`
- 冷却与节流：`lateNightAwarenessShownDate` 等本地键

**风险控制**：
- 单日触发限制与冷却时间，避免频繁打断
- 觉察文案优先级可控，不覆盖重要系统提示
- 不读取用户私密文本内容，仅基于行为与统计数据

**验证方式（验证逻辑）**：
- 觉察触发前后 10 分钟内是否产生新的专注记录（`FocusSession` / `todayStats` 可对比）
- 触发次数是否符合冷却约束（`lateNightAwarenessShownDate` 等本地键）

**迭代记录**：
- 增加优先级（低/中/高）与抢占策略，防止“文案噪音”
- 增加夜间提醒的单日触发限制（`lateNightAwarenessShownDate`）
- SpiritDialog 支持 awareness 文案与自定义展示时长
