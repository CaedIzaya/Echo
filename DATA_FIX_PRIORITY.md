# ğŸš¨ æ•°æ®ä¸¢å¤±ä¿®å¤ - ä¼˜å…ˆçº§æ¸…å•

## âš¡ å¿«é€Ÿæ€»ç»“

**å‘ç°é—®é¢˜**ï¼š3ä¸ªå…³é”®æ•°æ®åªå­˜å‚¨åœ¨ localStorageï¼Œä¼šä¸¢å¤±ï¼

| æ•°æ® | é—®é¢˜ | å½±å“ç”¨æˆ·æ„ŸçŸ¥ |
|------|------|------------|
| ç”¨æˆ·ç»éªŒå€¼ | âŒ æ¢è®¾å¤‡ä¸¢å¤± | ğŸ”´ **é«˜** - ç­‰çº§é‡ç½®å¾ˆæ˜æ˜¾ |
| æˆå°±åˆ—è¡¨ | âŒ æ¢è®¾å¤‡ä¸¢å¤± | ğŸ”´ **é«˜** - æˆå°±å…¨éƒ¨æ¶ˆå¤± |
| å¿ƒæ ‘ç»éªŒ | âŒ æ¢è®¾å¤‡ä¸¢å¤± | ğŸ”´ **é«˜** - å¿ƒæ ‘ç­‰çº§é‡ç½® |

**ç”¨æˆ·å¤´åƒ**ï¼šâœ… å·²æ´—æ¸…å«Œç–‘ï¼ˆå›¾åƒæ•°æ®ï¼Œç‰¹æ‰¹ localStorageï¼‰

---

## ğŸ”¥ ä¿®å¤ä¼˜å…ˆçº§

### Phase 1: å¿…é¡»ç«‹å³ä¿®å¤ ğŸ”´

**æ—¶é—´**ï¼š2-3 å°æ—¶  
**ç´§æ€¥åº¦**ï¼šğŸ”´ğŸ”´ğŸ”´ éå¸¸ç´§æ€¥

#### 1. ç”¨æˆ·ç»éªŒå€¼ç³»ç»Ÿ
- **æ•°æ®åº“å­—æ®µ**ï¼š`userExp`, `userLevel`
- **å½±å“**ï¼šç”¨æˆ·ç­‰çº§æ˜¾ç¤ºåœ¨é¡µé¢é¡¶éƒ¨ï¼Œéå¸¸æ˜¾çœ¼
- **ç”¨æˆ·æ„ŸçŸ¥**ï¼šâ­â­â­â­â­ å¾ˆæ˜æ˜¾

#### 2. æˆå°±ç³»ç»Ÿ
- **æ•°æ®åº“è¡¨**ï¼šæ–°å¢ `Achievement` è¡¨
- **å½±å“**ï¼šå·²è§£é”çš„æˆå°±ä¼šæ¶ˆå¤±
- **ç”¨æˆ·æ„ŸçŸ¥**ï¼šâ­â­â­â­â­ å¾ˆæ˜æ˜¾

#### 3. å¿ƒæ ‘ç»éªŒçŠ¶æ€
- **æ•°æ®åº“å­—æ®µ**ï¼š`heartTreeExp`, `heartTreeLevel`, `heartTreeCurrentExp`, `heartTreeTotalExp`
- **å½±å“**ï¼šå¿ƒæ ‘ç­‰çº§æ˜¾ç¤ºåœ¨å¿ƒæ ‘é¡µé¢
- **ç”¨æˆ·æ„ŸçŸ¥**ï¼šâ­â­â­â­ æ˜æ˜¾

---

### Phase 2: å¯ä»¥ç¨åä¿®å¤ ğŸŸ¡

**æ—¶é—´**ï¼š1 å°æ—¶  
**ç´§æ€¥åº¦**ï¼šğŸŸ¡ ä¸­ç­‰

#### 4. ç»Ÿè®¡æ•°æ®
- **æ•°æ®åº“**ï¼šå¯ä»¥ä» `FocusSession` é‡æ–°è®¡ç®—
- **å½±å“**ï¼šå†å²ç»Ÿè®¡å›¾è¡¨æ•°æ®
- **ç”¨æˆ·æ„ŸçŸ¥**ï¼šâ­â­ ä¸å¤ªæ˜æ˜¾

---

## ğŸ“‹ ä¿®å¤æ£€æŸ¥æ¸…å•

### âœ… å·²å®Œæˆ
- [x] å¿ƒæ ‘åå­—æŒä¹…åŒ– - **å·²ä¿®å¤** ğŸ‰

### âš ï¸ å¾…ä¿®å¤ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰
- [ ] ç”¨æˆ·ç»éªŒå€¼ç³»ç»Ÿ - **Phase 1.1**
- [ ] æˆå°±ç³»ç»Ÿ - **Phase 1.2**
- [ ] å¿ƒæ ‘ç»éªŒçŠ¶æ€ - **Phase 1.3**
- [ ] ç»Ÿè®¡æ•°æ® - **Phase 2**

---

## ğŸ¯ Phase 1 è¯¦ç»†æ­¥éª¤

### Phase 1.1: ç”¨æˆ·ç»éªŒå€¼ï¼ˆ30åˆ†é’Ÿï¼‰

#### 1. ä¿®æ”¹æ•°æ®åº“ Schema
```prisma
model User {
  // æ·»åŠ å­—æ®µ
  userExp     Float @default(0)
  userLevel   Int   @default(1)
}
```

#### 2. åˆ›å»º API
- `src/pages/api/user/exp/update.ts`
- `src/pages/api/user/exp/index.ts`

#### 3. åˆ›å»º Hook
- `src/hooks/useUserExp.ts`

#### 4. æ›´æ–°ç»„ä»¶
- `src/pages/dashboard/index.tsx`
- `src/pages/dashboard/index.mobile.tsx`

---

### Phase 1.2: æˆå°±ç³»ç»Ÿï¼ˆ45åˆ†é’Ÿï¼‰

#### 1. ä¿®æ”¹æ•°æ®åº“ Schema
```prisma
model Achievement {
  id            String   @id @default(cuid())
  userId        String
  achievementId String
  category      String
  unlockedAt    DateTime @default(now())
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([userId, achievementId])
  @@index([userId])
}

model User {
  // æ·»åŠ å…³ç³»
  achievements Achievement[]
}
```

#### 2. åˆ›å»º API
- `src/pages/api/achievements/unlock.ts`
- `src/pages/api/achievements/index.ts`

#### 3. åˆ›å»º Hook
- `src/hooks/useAchievements.ts`

#### 4. æ›´æ–°ç»„ä»¶
- `src/lib/AchievementSystem.tsx`
- `src/pages/dashboard/index.tsx`

---

### Phase 1.3: å¿ƒæ ‘ç»éªŒçŠ¶æ€ï¼ˆ45åˆ†é’Ÿï¼‰

#### 1. ä¿®æ”¹æ•°æ®åº“ Schema
```prisma
model User {
  // æ·»åŠ å­—æ®µ
  heartTreeLevel      Int      @default(1)
  heartTreeCurrentExp Float    @default(0)
  heartTreeTotalExp   Float    @default(0)
  lastWateredDate     String?
  fertilizerExpiresAt DateTime?
  fertilizerMultiplier Float?
}
```

#### 2. åˆ›å»º API
- `src/pages/api/heart-tree/exp/update.ts`
- `src/pages/api/heart-tree/exp/index.ts`

#### 3. åˆ›å»º Hook
- `src/hooks/useHeartTreeExp.ts`

#### 4. æ›´æ–°ç»„ä»¶
- `src/lib/HeartTreeExpSystem.ts`
- `src/pages/dashboard/HeartTree.tsx`

---

## ğŸš€ å¿«é€Ÿå¼€å§‹å‘½ä»¤

```bash
# 1. æŸ¥çœ‹å®Œæ•´å®¡è®¡æŠ¥å‘Š
cat DATA_PERSISTENCE_AUDIT.md

# 2. å¼€å§‹ä¿®å¤ Phase 1.1ï¼ˆç”¨æˆ·ç»éªŒå€¼ï¼‰
# - ä¿®æ”¹ prisma/schema.prisma
# - æ·»åŠ  userExp å’Œ userLevel å­—æ®µ

# 3. åº”ç”¨æ•°æ®åº“å˜æ›´
npm run db:push

# 4. åˆ›å»º API å’Œ Hook
# ï¼ˆæŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤ï¼‰

# 5. æµ‹è¯•
# - è·å¾—ç»éªŒ â†’ æ£€æŸ¥æ•°æ®åº“
# - æ¢è®¾å¤‡ç™»å½• â†’ éªŒè¯åŒæ­¥

# 6. æ¨é€ä»£ç 
git add .
git commit -m "fix: ç”¨æˆ·ç»éªŒå€¼æŒä¹…åŒ–åˆ°æ•°æ®åº“"
git push origin main
```

---

## ğŸ“Š ä¿®å¤è¿›åº¦è¿½è¸ª

| ä»»åŠ¡ | ä¼˜å…ˆçº§ | çŠ¶æ€ | é¢„è®¡æ—¶é—´ | å®é™…æ—¶é—´ |
|------|--------|------|---------|---------|
| å¿ƒæ ‘åå­— | ğŸ”´ | âœ… å®Œæˆ | 30min | - |
| ç”¨æˆ·ç»éªŒå€¼ | ğŸ”´ | âš ï¸ å¾…ä¿®å¤ | 30min | - |
| æˆå°±ç³»ç»Ÿ | ğŸ”´ | âš ï¸ å¾…ä¿®å¤ | 45min | - |
| å¿ƒæ ‘ç»éªŒ | ğŸ”´ | âš ï¸ å¾…ä¿®å¤ | 45min | - |
| ç»Ÿè®¡æ•°æ® | ğŸŸ¡ | âš ï¸ å¾…ä¿®å¤ | 60min | - |

**æ€»é¢„è®¡æ—¶é—´**: çº¦ 3-4 å°æ—¶

---

## ğŸ ä¿®å¤åçš„å¥½å¤„

### ç”¨æˆ·ä½“éªŒ
- âœ… æ•°æ®æ°¸ä¹…ä¿å­˜
- âœ… æ¢è®¾å¤‡è‡ªåŠ¨åŒæ­¥
- âœ… æ¸…é™¤æµè§ˆå™¨æ•°æ®ä¸ä¸¢å¤±
- âœ… å¤šè®¾å¤‡ä½¿ç”¨æ— ç¼åˆ‡æ¢

### æŠ€æœ¯ä¼˜åŠ¿
- âœ… æ•°æ®å®‰å…¨å¯é 
- âœ… è‡ªåŠ¨è¿ç§»æ—§æ•°æ®
- âœ… åŒé‡ä¿å­˜ç­–ç•¥ï¼ˆé€Ÿåº¦+å®‰å…¨ï¼‰
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†

---

## ğŸ’¡ å»ºè®®

### ç«‹å³è¡ŒåŠ¨
**å»ºè®®ä»Šå¤©å®Œæˆ Phase 1**ï¼Œé¿å…æ›´å¤šç”¨æˆ·é‡åˆ°æ•°æ®ä¸¢å¤±é—®é¢˜ã€‚

### ç”¨æˆ·é€šçŸ¥
ä¿®å¤å®Œæˆåï¼Œå»ºè®®æ˜¾ç¤ºä¸€æ¬¡æ€§é€šçŸ¥ï¼š
```
ğŸ‰ æ•°æ®å®‰å…¨å‡çº§å®Œæˆ
ä½ çš„ç»éªŒã€æˆå°±ã€å¿ƒæ ‘ç­‰çº§ç°åœ¨æ°¸ä¹…ä¿å­˜ï¼Œ
æ¢è®¾å¤‡ä¹Ÿä¸ä¼šä¸¢å¤±äº†ï¼
```

### ç›‘æ§
- æ·»åŠ æ•°æ®åŒæ­¥æˆåŠŸç‡ç›‘æ§
- è®°å½•è¿ç§»å¤±è´¥çš„æƒ…å†µ
- æ”¶é›†ç”¨æˆ·åé¦ˆ

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

**æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£**ï¼š
- `DATA_PERSISTENCE_AUDIT.md` - å®Œæ•´å®¡è®¡æŠ¥å‘Š
- `HEART_TREE_NAME_FIX.md` - å¿ƒæ ‘åå­—ä¿®å¤æ¡ˆä¾‹

**ä¸‹ä¸€æ­¥**ï¼š
1. é˜…è¯»å®Œæ•´å®¡è®¡æŠ¥å‘Šäº†è§£è¯¦æƒ…
2. æŒ‰ç…§æœ¬æ–‡æ¡£çš„ä¼˜å…ˆçº§å¼€å§‹ä¿®å¤
3. æ¯å®Œæˆä¸€é¡¹åœ¨æ£€æŸ¥æ¸…å•ä¸­æ‰“å‹¾

---

**åˆ›å»ºæ—¥æœŸ**: 2024-12-16  
**çŠ¶æ€**: âš ï¸ å‘ç°é«˜å±é—®é¢˜  
**å»ºè®®**: ğŸ”´ ç«‹å³ä¿®å¤ Phase 1



